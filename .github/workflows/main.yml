name: Test nxsbom-cli (Ubuntu + Fedora + CentOS + RHEL + Alma + Oracle + Amazon)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-cli:
    strategy:
      matrix:
        os: [
          ubuntu-latest,
          fedora:latest,
          centos:stream8,
          rhel:latest,
          almalinux:latest,
          oraclelinux:9,
          amazonlinux:2,
          amazonlinux:2023
        ]
    runs-on: ubuntu-latest
    container: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v3

      # --------------------------------------------------------------- 
      # Install Dependencies
      # ---------------------------------------------------------------
      - name: Install deps (Ubuntu/Debian)
        if: contains(matrix.os, 'ubuntu') || contains(matrix.os, 'debian')
        run: |
          apt-get update
          apt-get install -y curl tar gzip

      - name: Install deps (Fedora)
        if: contains(matrix.os, 'fedora')
        run: |
          dnf install -y curl tar gzip

      - name: Install deps (CentOS/RHEL/Alma/Oracle)
        if: contains(matrix.os, 'centos') || contains(matrix.os, 'rhel') || contains(matrix.os, 'almalinux') || contains(matrix.os, 'oraclelinux')
        run: |
          yum install -y curl tar gzip

      - name: Install deps (Amazon Linux)
        if: contains(matrix.os, 'amazonlinux')
        run: |
          yum install -y curl tar gzip

      # --------------------------------------------------------------- 
      # Download & Run CLI
      # ---------------------------------------------------------------
      - name: Download nxsbom-cli
        run: |
          curl -L https://github.com/atif-80/cli-public/releases/latest/download/nxsbom-cli-linux-x64.tar.gz -o nxsbom.tar.gz
          tar -xzf nxsbom.tar.gz
          chmod +x nxsbom-cli

      - name: Run CLI
        run: |
          ./nxsbom-cli -h
